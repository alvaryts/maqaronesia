{% extends "base.html" %}

{% block title %}{{ lesson.title }} | Maqaronesia{% endblock %}

{% block content %}
<div class="drawer lg:drawer-open">
    <input id="course-drawer" type="checkbox" class="drawer-toggle" />

    <!-- Lesson Content (Main) -->
    <div class="drawer-content flex flex-col p-4 md:p-8">
        <div class="max-w-4xl mx-auto w-full">
            <!-- Breadcrumbs -->
            <div class="text-sm breadcrumbs mb-6 hidden md:block">
                <ul>
                    <li><a href="{% url 'courses:course_list' %}">Cursos</a></li>
                    <li><a href="{% url 'courses:course_detail' lesson.module.course.slug %}">{{
                            lesson.module.course.title|truncatechars:20 }}</a></li>
                    <li>{{ lesson.module.title|truncatechars:20 }}</li>
                    <li>{{ lesson.title }}</li>
                </ul>
            </div>

            <!-- Mobile Toggle -->
            <label for="course-drawer" class="btn btn-outline btn-sm mb-4 lg:hidden">
                <i data-lucide="menu"></i> Ver Temario
            </label>

            <h1 class="text-3xl font-bold font-heading mb-6">{{ lesson.title }}</h1>

            {% if lesson.video_url %}
            <div class="mockup-window border bg-base-300 mb-8 p-0 overflow-hidden shadow-xl">
                <div class="aspect-video bg-black flex items-center justify-center">
                    <iframe class="w-full h-full" src="{{ lesson.video_url }}" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen></iframe>
                </div>
            </div>
            {% endif %}

            <div class="prose prose-lg max-w-none">
                {{ lesson.content|linebreaks }}
            </div>

            <div class="flex justify-between items-center mt-12 pt-6 border-t border-base-200">
                <button class="btn btn-neutral btn-outline gap-2">
                    <i data-lucide="chevron-left"></i> Anterior
                </button>

                <button class="btn btn-primary gap-2">
                    Marcar como Completa <i data-lucide="check-circle"></i>
                </button>

                <button class="btn btn-neutral btn-outline gap-2">
                    Siguiente <i data-lucide="chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Sidebar (Drawer Side) -->
    <div class="drawer-side z-20">
        <label htmlFor="course-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        <div class="menu p-4 w-80 min-h-full bg-base-200 text-base-content">
            <!-- Sidebar Content -->
            <div class="mb-6 px-2">
                <h2 class="font-bold text-lg leading-tight">{{ lesson.module.course.title }}</h2>
                <div class="progress w-full mt-2" value="40" max="100"></div>
                <p class="text-xs mt-1 text-base-content/60">40% Completado</p>
            </div>

            {% for module in lesson.module.course.modules.all %}
            <div class="collapse collapse-arrow bg-base-100 mb-2 rounded-box">
                <input type="checkbox" {% if module==lesson.module %}checked{% endif %} />
                <div class="collapse-title text-sm font-medium p-3 min-h-0 py-3">
                    {{ module.title }}
                </div>
                <div class="collapse-content p-0">
                    <ul class="menu menu-xs rounded-none">
                        {% for l in module.lessons.all %}
                        <li>
                            <a href="{% url 'courses:lesson_detail' lesson.module.course.slug l.slug %}"
                                class="{% if l == lesson %}active{% endif %} py-3">
                                {% if l == lesson %}
                                <i data-lucide="play" class="w-3 h-3"></i>
                                {% else %}
                                <i data-lucide="circle" class="w-3 h-3"></i>
                                {% endif %}
                                {{ l.title }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}